计算某点离海岸线的距离
######################

:date: 2014-02-21 17:53
:modified: 2015-02-27
:author: SeisMan
:category: GMT
:tags: 距离, GMT技巧
:slug: calculate-distance-to-coast

.. contents::

要计算某个点到海岸线的距离，思路很简单，先获取离散的海岸线数据，然后计算该点到所有海岸线数据点的距离，取其中的最小值即可认为是海岸线的距离。

获取海岸线数据
==============

海岸线数据可以从GMT的GSHHG数据中提取，命令如下::

    pscoast -Di -Rd -W -m > coast.txt

简单解释一下:

- GSHHG包含了5种不同精度的数据，分别为f, h, i, l, c，过高精度的数据包含了太多的细节、过低精度的数据丢失了太多细节。选择哪一种精度的数据需要仔细权衡。
- -R限定了感兴趣的海岸线数据的范围。
- -W表示提取海岸线数据，还可以使用-I提取河流数据，使用-N提取国界数据；
- -m表示将数据以ASCII格式输出

需要注意，该命令提取出的海岸线数据包含了全部4个level的数据，即海岸线数据、湖岸线数据、湖内岛数据以及湖内岛的内湖数据，如只需要Level1即海岸线的数据，则需要使用gmtconvert对数据进行进一步处理::

    gmtconvert coast.txt -m -S"Level 1" > coast_1.txt

该命令的\ ``-S"Level 1"``\ 表示仅提头段记录中包含字符“Level 1”的线段。

在GMT5中，该命令应该这样写::

    gmt pscoast -Di -Rd -W -M > coast.txt
    gmt gmtconvert coast.txt -S"Level 1" > coast_1.txt

计算点到海岸线的距离
====================

grdmath
========

GMT的grdmath命令可以对网格数据进行多种数学操作，其中之一就是计算点到海岸线的距离。

对于网格的每个点，计算该点到海岸线数据的所有点的距离，找出离海岸线最小距离，将该最小距离作为该网格点的Z值。

GMT设计了这样一个复杂的命令，却没有“计算点到海岸线的距离”这个更基本的命令。

grdmath示例
===========

::

    $ grdmath -R240/242/30/32 -I1 coast_1.txt LDIST -fg = dist.grd
    $ grd2xyz dist.grd
    240 32  143.351409912
    241 32  104.02256012
    242 32  82.0522842407
    240 31  249.291519165
    241 31  207.351837158
    242 31  138.527618408
    240 30  183.434417725
    241 30  111.675422668
    242 30  92.7098999023

说明:

- 这里通过-R和-I选项指定网格的区域以及间隔，也可以直接读取一个网格文件；
- 参数格式为\ ``操作数 操作符 = 输出网格文件名``\ ，操作符\ ``LDIST``\ 需要一个操作数\ ``coast_1.txt``\ 。注意这里\ ``coast_1.txt``\ 的位置必须在\ ``LDIST``\ 之前。
- 默认情况下会计算网格点与线段之间的笛卡尔距离，\ ``-fg``\ 选项表明输入数据为地理坐标，此时的输出为千米。
- 通过grd2xyz可以看到计算的结果，这里计算出了9个点与海岸线的距离，单位千米。

计算一点到海岸线的距离
======================

上面的例子中，\ ``-R240/242/30/32 -I1``\ 指定的网格中包含了9个点，然后计算出了9个点到海岸线的距离。当只需要计算某个点到海岸线的距离时，理论上只要网格中只包含一个点就可以了。

想要构建一个只含一个点的网格，网格必须使用像素网格配准方式。

使用默认的网格线配准方式，网格中至少会有四个网格点::

    $ grdmath -R240/241/30/31 -I1 coast.txt LDIST -fg = dist.grd
    $ grd2xyz dist.grd
    240 31  249.291519165
    241 31  207.351837158
    240 30  183.434417725
    241 30  111.675422668

通过\ ``-F``\ 使用像素配准方式，则生成的网格中只有一个点::

    $ grdmath -R240/241/30/31 -I1 -F -fg coast_1.txt LDIST = dist.grd
    $ grd2xyz dist.grd
    240.5   30.5    184.780654907

想要计算点(240.111, 30.222)到海岸线的距离::

    $ grdmath -R240.011/240.211/30.122/30.322 -I0.2 -F -fg coast_1.txt LDIST = dist.grd
    $ grd2xyz dist.grd
    240.111 30.222  188.54675293

注意理解-R和-I是如何选取的！

在GMT5下命令如下::

    $ gmt grdmath -R240.011/240.211/30.122/30.322 -I0.2 -r -fg coast_1.txt LDIST = dist.grd
    $ gmt grd2xyz dist.grd
    240.111 30.222  188.537643433

参考
====

- http://oceancolor.gsfc.nasa.gov/DOCS/DistFromCoast/

修订历史
========

- 2014-02-01：初稿；
- 2015-02-27：使用gmtconvert提取指定Level的数据；grdmath中应使用\ ``-fg``\ 选项才会计算得到笛卡尔距离；Thanks to Jiangbo；
